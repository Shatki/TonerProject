{% block docview %}
    <div style="width:100%;height:100%;padding:0">

        {% block index %}
            <div id="doc-id" hidden="hidden">{{ consignment.id }}</div>
        {% endblock index %}

        {% block mainmenu %}
            {% include 'menu.html' %}
        {% endblock mainmenu %}

        {% block reqvisites %}
            <div id="header-toolbar-consignment-{{ consignment.id }}" style="margin: 5px 20px 5px 20px">
                <form id="doc-req-fm-consignment-{{ consignment.id }}">
                    {% block consignment_number %}
                        <input class="easyui-textbox" name="number" required="required" style="width: 100px"
                               label="Накладная №"
                               data-options="onChange:function(number){renameTab(number,0)}"
                               labelPosition="top"
                                {% if not consignment.number %}
                               value="Новая"
                                {% else %}
                               value="{{ consignment.number }}"
                                {% endif %}
                               placeholder="0000000001" type="number">
                        <span>от</span>
                        <input class="easyui-datebox" name="date" required="required" style="width: 285px"
                               data-options="panelWidth:285,currentText:'Сегодня',closeText:'Закрыть',
                       onChange:function(date){renameTab(0,date)}"
                               labelPosition="top"
                               value="{{ consignment.str_date }}"
                               placeholder="31/10/1985">
                    {% endblock consignment_number %}

                    {% block contractors %}
                        {% block emitter %}
                            <select id="emitter-consignment-{{ consignment.id }}" name="emitter" label="Продавец:"
                                    class="easyui-combobox"
                                    labelPosition="top">

                                {% for contractor in contractors %}
                                    {% if contractor.id == consignment.emitter.id %}
                                        <option selected>{{ contractor.name }}</option>
                                    {% else %}
                                        <option>{{ contractor.name }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        {% endblock emitter %}

                        {% block receiver %}
                            <select id="receiver-consignment-{{ consignment.id }}" name="receiver" label="Покупатель:"
                                    class="easyui-combobox"
                                    labelPosition="top">

                                {% for contractor in contractors %}
                                    {% if contractor.id == consignment.receiver.id %}
                                        <option selected>{{ contractor.name }}</option>
                                    {% else %}
                                        <option>{{ contractor.name }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        {% endblock receiver %}
                    {% endblock contractors %}
                </form>
            </div>
        {% endblock reqvisites %}

        {% block maintab %}
            <table id="item-table-consignment-{{ consignment.id }}" title="Таблица товаров" width="100% "
                   class="easyui-datagrid"
                    {% if consignment.id %}
                   url="/document/consignment/{{ consignment.id }}/items/json/"
                    {% endif %}
                   idField="id" textField='name' toolbar="#item-toolbar" pagination="true" rownumbers="true"
                   fitColumns="true" singleSelect="true">
                <thead>
                <tr>
                    <th field="ck" checkbox="true"></th>
                    <th field="id" align="center">id</th>
                    <th data-options="field:'itemName',width:'30%', editor:{
                        type: 'combotreegrid',
                        options: {
                            columns: [[
                                {field:'itemId',title:'Item ID',width:'10%'},
                                {field:'itemName',title:'Name',width:'70%'},
                                {field:'parentId',title:'parentId',width:'10%'}
                            ]],
                            idField: 'itemId',
                            treeField: 'itemName',
                            url:'/catalog/product/json/',
                            animate:true,
                            panelWidth: '50%',
                            loadFilter: function(rows){return productLoadFilter(rows);}
                        }}">
                        <div align="center">Наименование товара, работ, услуг</div>
                    </th>
                    <th data-options="field:'measure', width:'5%', align:'center', editor:{
                        type:'combogrid',
                        options:{
                            idField:'id',
                            textField: 'name',
                            scrollbarSize:0,
                            url:'/system/measure/json/',
                            columns:[[
                                    {field:'name',
                                     title:'Ед. изм.',
                                     width:'100%'},
                                    ]]
                            }}"><strong>Ед. </strong>изм.<br><em>(шт., кг и т.д.)</em></th>
                    <th data-options="field:'quantity', width:'5%', align:'center', editor:{
                        type:'numberbox',
                        options:{
                            precision:2
                            }}">Кол-во<br><em>(единиц)</em></th>
                    <th data-options="field:'country', width:'10%', align:'center', editor:{
                        type: 'combogrid',
                        options:{
                            idField: 'id',
                            textField: 'name',
                            url:'/system/country/json/',
                            columns:[[
                                    {field:'name',
                                     title:'Страна изготовитель',
                                     width:'100%'},
                                    ]]
                            }}"><p>Страна<br>изготовитель</p></th>
                    <th data-options="field:'cost', width:'10%', align:'center', editor:{
                        type:'numberbox',
                        options:{
                            precision:2
                            }}" formatter="formatDollar"><p>Цена<br>за единицу</p></th>
                    <th data-options="field:'tax', width:'10%', align:'center', editor:{
                        type:'numberbox',
                        options:{
                            precision:2
                            }}"><p>Налог</p></th>
                    <th data-options="field:'total', width:'5%', align:'center', editor:{
                        type:'numberbox',
                        options:{
                            precision:2
                            }}">Сумма
                    </th>
                </tr>
                </thead>

                {% block itemtable-menu %}
                    <div id="item-toolbar-{{ consignment.id }}">
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true"
                           onclick="addItem('#item-table-consignment-' + '{{ consignment.id }}')">Добавить</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true"
                           onclick="editItem('#item-table-consignment-' + '{{ consignment.id }}')">Редактировать</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true"
                           onclick="deleteItem('#item-table-consignment-' + '{{ consignment.id }}')">Удалить</a>
                    </div>
                {% endblock itemtable-menu %}

            </table>
        {% endblock maintab %}
    </div>
{% endblock docview %}

{% block doc-scripts %}
    <script type="text/javascript">
        $(function () {
            enableDoc('#item-table-consignment-' + '{{ consignment.id }}');
        });
    </script>

{% endblock doc-scripts %}